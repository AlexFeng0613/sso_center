<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	  layout:decorator="../../public/register">
	<head>
		<style>
			.progress_2{
				width:870px;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid" layout:fragment="content">
			<div class="center">
				<form name="inviteForm" >
					<input type="hidden" name="email" th:value="${email}"/>
					<div class="invite">
						<div class="invite_box">
							<div class="invite_box_l">邀请码</div>
							<input type="text" class="inviteCode" placeholder="请输入您的邀请码"/>
							<div class="mistake"></div>
							<div class="correct"></div>
						</div>
						<div class="ipone_box_next">
							<div class="ipone_next">下一步</div>
							<div class="skip">跳过</div>
						</div>
					</div>
				</form>
			</div>
			<script type="text/javascript">
				$(function(){
					var demo=$(".inviteForm").Validform({
						btnSubmit:'.invite_next',
						tiptype:3,
						showAllError:false,
						datatype:{
							"n8":/^\d{8}$/
						},
						callback : function(form){
							if(true){
								var data = {
									'email' : $('input[name="email"]').val(),
									'inviteCode' : $('.verify_code').val()
								}
								$.ajax({
									url : '/user/checkInviteCode.json',
									type : 'post',
									data : JSON.stringify(data),
									contentType: 'application/json',
									dataType : 'json',
									success : function(data){
										if(data.success){
											//成功跳转
											$.ajax({
												url : '/user/activateInviteCode.json',
												type : 'post',
												data : JSON.stringify(),
												contentType : 'application/json',
												dataType : 'json',
												success : function(){
													activateInviteCode();
												}
											});
										} else {
											//否则提示错误
											$.Showmsg('邀请码错误!');
										}
									}
								})
							}
							return false;
						}
					});
					demo.tipmsg.w["n8"]="请输入8位数的邀请码";

					demo.addRule([{
						ele:".inviteCode:eq(0)",
						datatype:"n8",
						nullmsg:'请输入邀请码',
						sucmsg:' '
					}]);

					//跳过click函数
					$('.skip').click(function(){
						activateInviteCode();
					});
				});

				/**
				 * 激活验证码
				 */
				function activateInviteCode(){
					var email = $('input[name="email"]').val();
					var data = {
						'email' : email
					};
					$.ajax({
						url : '/user/activateInviteCode.html',
						type : 'post',
						data : JSON.stringify(data),
						contentType : 'application/json',
						dataType : 'json',
						success : function(){
						}
					});
				}
			</script>
		</div>
	</body>
</html>


