<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="../../public/yun">
    <head>
        <link th:href="@{/static/css/validform.css}" href="../../../static/css/validform.css" rel="stylesheet" type="text/css"/>
        <script text="text/javascript" th:src="@{/static/scripts/jquery/jquery-1.11.3.min.js}" src="../../../static/scripts/jquery/jquery-1.11.3.min.js"></script>
        <script text="text/javascript" th:src="@{/static/scripts/ie/html5shiv.js}" src="../../../static/scripts/ie/html5shiv.js"></script>
        <script text="text/javascript" th:src="@{/static/scripts/ie/placeholder.js}"  src="../../../static/scripts/ie/placeholder.js"></script>
        <script text="text/javascript" th:src="@{/static/scripts/validform/Validform_v5.3.2_min.js}" src="../../../static/scripts/validform/Validform_v5.3.2_min.js"></script>
    </head>
    <body>
        <div id="content" layout:fragment="content">
           <div class="long_input_box">
               <form class="inviteCodeForm" action="/sso/bindInviteCode.json" method="post">
                   <div class="long_input_top">
                       <div id="input_font" class="input_font">邀请码</div>
                       <input type="text" class="email" name="inviteCode"/>
                       <input type="button" class="email_submit" value="下一步"/>
                   </div>
               </form>
           </div>
            <script type="text/javascript">
                $(function(){
                    $('#bindInviteCode').addClass('selected');
                    $('#bindInviteCode a').addClass('selected');

                    var inviteCodeForm = $('.inviteCodeForm').Validform({
                        tiptype:3,
                        label:".label",
                        showAllError:true,
                        datatype:{
                            "s10":/^[\w\.\s]{10}$/
                        },
                        callback : function(form){
                            /**
                             * 绑定邀请码(submit请求)
                             */
                            var inviteCode = $('input[name="inviteCode"]').val();
                            var data = {
                                'inviteCode' : inviteCode
                            }
                            $.ajax({
                                url : '/sso/bindInviteCode.json',
                                type : 'POST',
                                data : JSON.stringify(data),
                                contentType: 'application/json',
                                dataType : 'json',
                                success : function(data){
                                    if(data.success){
                                        window.location.href = '/sso/personalSettings.html';
                                    }else {
                                        alert(ErrorMessage[data.message])
                                        if(data.message == '100007') {
                                            window.location.href = "/user/login.html";
                                        }
                                    }
                                }
                            });
                        }
                    });

                    inviteCodeForm.tipmsg.w["s10"]=" ";
                    inviteCodeForm.addRule([{
                        ele : "#input_font",
                        datatype : "s10"
                    }]);

                });
           </script>
        </div>
    </body>
</html>